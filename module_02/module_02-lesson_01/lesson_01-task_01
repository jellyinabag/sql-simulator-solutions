/*
Задание:
Для каждого дня, представленного в таблицах user_actions и courier_actions, рассчитайте следующие показатели:
- Число новых пользователей.
- Число новых курьеров.
- Общее число пользователей на текущий день.
- Общее число курьеров на текущий день.
Колонки с показателями назовите соответственно new_users, new_couriers, total_users, total_couriers. Колонку с датами назовите date. Проследите за тем, чтобы показатели были выражены целыми числами. 
Результат должен быть отсортирован по возрастанию даты.
Поля в результирующей таблице: date, new_users, new_couriers, total_users, total_couriers
*/

with date_users as (SELECT (min(time))::date as date,
                           user_id
                    FROM   user_actions
                    GROUP BY user_id), count_users as (SELECT date,
                                          count(user_id) as new_users
                                   FROM   date_users
                                   GROUP BY date), date_couriers as (SELECT (min(time))::date as date,
                                         courier_id
                                  FROM   courier_actions
                                  GROUP BY courier_id), count_couriers as (SELECT date,
                                                count(courier_id) as new_couriers
                                         FROM   date_couriers
                                         GROUP BY date)
SELECT count_users.date,
       new_users,
       new_couriers,
       (sum(new_users) OVER(ORDER BY date rows between unbounded preceding and current row))::integer as total_users,
       (sum(new_couriers) OVER(ORDER BY date rows between unbounded preceding and current row))::integer as total_couriers
FROM   count_users full join count_couriers using(date)
