/*
Задание:
Выясните, есть ли в таблице user_actions такие заказы, которые были приняты курьерами, но не были доставлены пользователям. Посчитайте количество таких заказов.
Колонку с числом заказов назовите orders_count.
Поле в результирующей таблице: orders_count
*/

SELECT count(distinct order_id) filter (WHERE order_id in (SELECT order_id
                                                           FROM   courier_actions
                                                           WHERE  action = 'accept_order')) as orders_count
FROM   user_actions
WHERE  order_id not in (SELECT order_id
                        FROM   courier_actions
                        WHERE  action = 'deliver_order')
